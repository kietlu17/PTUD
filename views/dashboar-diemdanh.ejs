<%- include('partials/header', { title: 'ƒêi·ªÉm Danh H·ªçc Sinh' }) %>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 sidebar">
                <div class="text-center fw-semibold mb-3">
                    üë©‚Äçüè´
                    <%= giaoVien.HoVaTen %>
                </div>
                <a href="/dashboard-giaovien">Trang Dashboard</a>
                <a href="#" class="active">ƒêi·ªÉm danh</a>
                <a href="#">Nh·∫≠p ƒëi·ªÉm</a>
                <a href="#">Ch·∫•m b√†i t·∫≠p</a>
                <a href="#">Giao b√†i t·∫≠p</a>
                <form id="logoutForm" action="/logout" method="POST" style="display:none;"></form>
                <button class="logout-btn" onclick="document.getElementById('logoutForm').submit()">ƒêƒÉng xu·∫•t</button>
            </nav>

            <!-- Main content -->
            <main class="col-md-10 content">
                <h2 class="text-center my-4">ƒêi·ªÉm Danh H·ªçc Sinh</h2>

                <!-- Ch·ªçn l·ªõp c·∫ßn ƒëi·ªÉm danh -->
                <div id="chon-lop">
                    <h5 class="fw-bold mb-3">Ch·ªçn l·ªõp c·∫ßn ƒëi·ªÉm danh</h5>
                    <% if (khoiLop && khoiLop.length > 0) { %>
                        <% khoiLop.forEach(khoi => { %>
                            <div class="mb-3">
                                <button class="btn btn-outline-secondary w-100 text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= khoi.tenKhoi %>">
                <%= khoi.tenKhoi %>
              </button>
                                <div id="collapse-<%= khoi.tenKhoi %>" class="collapse mt-2">
                                    <% khoi.lopList.forEach(lop => { %>
                                        <button class="btn btn-light w-100 mb-1 text-start btn-chon-lop" data-lop="<%= lop.TenLop %>">
                    <%= lop.TenLop %>
                  </button>
                                        <% }); %>
                                </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <div class="alert alert-info">Ch∆∞a c√≥ danh s√°ch l·ªõp ƒë·ªÉ ƒëi·ªÉm danh.</div>
                                    <% } %>
                </div>

                <!-- B·∫£ng ƒëi·ªÉm danh -->
                <div id="bang-diemdanh" class="d-none">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 id="ten-lop" class="fw-bold"></h5>
                        <div>
                            <%= new Date().toLocaleDateString('vi-VN') %>
                        </div>
                    </div>

                    <table class="table table-bordered align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>STT</th>
                                <th>H·ªçc sinh</th>
                                <th>Chuy√™n c·∫ßn</th>
                            </tr>
                        </thead>
                        <tbody id="ds-hocsinh">
                            <!-- render b·∫±ng JS -->
                        </tbody>
                    </table>

                    <div class="text-center mt-3">
                        <button id="btn-xacnhan" class="btn btn-primary">X√°c nh·∫≠n</button>
                    </div>
                    <div id="message-area" class="mt-3 text-center"></div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Danh s√°ch m·∫´u h·ªçc sinh (b·∫°n c√≥ th·ªÉ thay b·∫±ng fetch API sau)
        const mockData = {
            "10A": ["Nguy·ªÖn VƒÉn A", "Nguy·ªÖn VƒÉn B", "Nguy·ªÖn VƒÉn C"],
            "10B": ["Nguy·ªÖn VƒÉn D", "Nguy·ªÖn VƒÉn E"],
            "10C": ["Nguy·ªÖn VƒÉn F", "Nguy·ªÖn VƒÉn G", "Nguy·ªÖn VƒÉn H"]
        };

        const btnChonLopList = document.querySelectorAll('.btn-chon-lop');
        const bangDiemDanh = document.getElementById('bang-diemdanh');
        const tenLop = document.getElementById('ten-lop');
        const tbody = document.getElementById('ds-hocsinh');
        const messageArea = document.getElementById('message-area');

        btnChonLopList.forEach(btn => {
            btn.addEventListener('click', () => {
                const lop = btn.dataset.lop;
                tenLop.textContent = `L·ªõp ${lop}`;
                tbody.innerHTML = '';

                (mockData[lop] || []).forEach((hs, i) => {
                    tbody.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${hs}</td>
            <td>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="status${i}" value="C√≥ m·∫∑t">
                <label class="form-check-label">C√≥ m·∫∑t</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="status${i}" value="V·∫Øng (KP)">
                <label class="form-check-label">V·∫Øng (KP)</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="status${i}" value="ƒêi mu·ªôn">
                <label class="form-check-label">ƒêi mu·ªôn</label>
              </div>
            </td>
          </tr>`;
                });

                document.getElementById('chon-lop').classList.add('d-none');
                bangDiemDanh.classList.remove('d-none');
                messageArea.innerHTML = '';
            });
        });

        document.getElementById('btn-xacnhan').addEventListener('click', () => {
            const radios = document.querySelectorAll('input[type="radio"]:checked');
            const total = document.querySelectorAll('tbody tr').length;

            if (radios.length < total) {
                messageArea.innerHTML = `
        <div class="alert alert-danger">
          L∆∞u th·∫•t b·∫°i, c√≥ h·ªçc sinh ch∆∞a ƒë∆∞·ª£c ƒëi·ªÉm danh!
          <br><button class="btn btn-secondary mt-2" onclick="resetPage()">Quay l·∫°i</button>
        </div>`;
            } else {
                messageArea.innerHTML = `
        <div class="alert alert-success">
          ƒêi·ªÉm danh th√†nh c√¥ng!
          <br><button class="btn btn-secondary mt-2" onclick="resetPage()">Quay l·∫°i</button>
        </div>`;
            }
        });

        function resetPage() {
            document.getElementById('chon-lop').classList.remove('d-none');
            document.getElementById('bang-diemdanh').classList.add('d-none');
            messageArea.innerHTML = '';
        }
    </script>

    <%- include('partials/footer') %>