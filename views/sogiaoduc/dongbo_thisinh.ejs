<%- include('../partials/header', { title: 'Dashboard Nhân Viên Sở' }) %>

    <div class="container-fluid">
        <div class="row">

            <!-- Sidebar -->
            <%- include('../partials/nav-sogiaoduc', { profile, currentUrl }) %>


                <!-- Main Content -->
                <main class="col-md-10 content">

<div class="container mt-4">

    <h3 class="mb-3">Đồng bộ thí sinh từ hồ sơ đăng ký</h3>

    <div class="card shadow-sm">
        <div class="card-body">

            <!-- Số hồ sơ chờ đồng bộ -->
            <p class="fs-5 mb-3">
                <strong>Số hồ sơ chờ đồng bộ:</strong>
                <span class="badge bg-primary fs-6">
                    <%= soChoDongBo %>
                </span>
            </p>

            <!-- Các nút chức năng -->
            <div class="d-flex gap-2">

                <!-- Nút đồng bộ -->
<button id="btnDongBo" class="btn btn-success px-4">
  Đồng bộ ngay
</button>





                <!-- Nút xem lịch sử -->
                <a href="/admin/dongbo/thisinh/lichsu" class="btn btn-secondary px-4">
                    Xem lịch sử
                </a>

            </div>

        </div>
    </div>
</div>


<div id="ketquaDongBo" class="mt-3"></div>

                </main>

        </div>
    </div>

    </body>

    </html>

<script>
document.getElementById('btnDongBo').addEventListener('click', async () => {
  const btn = event.target;
  btn.disabled = true;
  btn.innerText = 'Đang xử lý...';

  const res = await fetch('/sogiaoduc/tuyensinh/dongbo', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' }
  });

  const data = await res.json();

  btn.disabled = false;
  btn.innerText = 'Đồng bộ ngay';

  document.getElementById('ketquaDongBo').innerHTML = `
    <div class="alert alert-${data.success ? 'success' : 'danger'}">
      <p><b>Tổng hồ sơ:</b> ${data.tong}</p>
      <p><b>Thành công:</b> ${data.thanhcong}</p>
      <p><b>Thất bại:</b> ${data.thatbai}</p>
    </div>
  `;
});
</script>